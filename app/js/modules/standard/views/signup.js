// Generated by CoffeeScript 1.6.2
(function() {
  define(["jquery", "underscore", "backbone", "text!html/standard/signup.html", "text!html/email/signup.html", "js/modules/standard/models/signup", "js/models/email", "js/views/alerts"], function($, a, b, template, tSignup, mRegister, mEmail, vAlerts) {
    var view;

    view = Backbone.View.extend({
      events: {
        "click #complete": "register"
      },
      register: function() {
        var self;

        this.model = new mRegister(this.collect());
        self = this;
        return this.model.save({}, {
          success: function(model, response) {
            var data, email, message;

            message = "Registration was successful. Check your email for your password and account information.";
            message += "<br /><strong>Password:</strong> " + response.password;
            vAlerts.add("complete", message, "1", "");
            data = self.collect();
            message = _.template(tSignup, data);
            email = new mEmail({
              recipient_name: data.first + " " + data.last,
              recipient_email: data.email,
              subject: "Your Phourus Password",
              message: message
            });
            return email.save({
              success: function() {},
              error: function() {
                return vAlerts.add("message", "Registration was successful, but there was an error sending your email. Please contact us if you do not receive your password.", "1", "");
              }
            });
          },
          error: function(model, response) {
            console.log(model);
            return console.log(response);
          }
        });
      },
      collect: function() {
        var me, output;

        me = this;
        output = {
          first: $("#first").val(),
          last: $("#last").val(),
          email: $("#email").val(),
          password: $("#password").val()
        };
        return output;
      },
      render: function() {
        var compiled, data;

        data = {};
        Backbone.Events.trigger("sidebar", "general");
        compiled = _.template(template, data);
        this.$el.html(compiled);
        return compiled;
      }
    });
    return view;
  });

}).call(this);
